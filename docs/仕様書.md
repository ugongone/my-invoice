# 簡易請求書作成Webアプリ 機能仕様書

## 1. 概要
本アプリケーションは、個人事業主やフリーランスを対象とした、ブラウザ完結型の簡易請求書作成ツールである。
ユーザー認証やサーバーサイドのデータベースを持たず、ブラウザのローカルストレージを利用してデータを保存することで、「シンプルさ」と「即時利用性」を提供する。

## 2. システム要件
- **プラットフォーム**: Webブラウザ（Chrome, Safari, Edge, Firefox等のモダンブラウザ）
- **技術スタック**: React, Tailwind CSS
- **データ保存先**: ブラウザのLocalStorage

## 3. 機能一覧

### 3.1. 編集機能（WYSIWYG）
- **プレビュー直接編集**: 請求書レイアウト上のテキストエリアをクリックすることで、直接内容を編集できる。
- **編集可能項目**:
  - 請求書番号（デフォルト形式: YYYYMM-01）
  - 発行日
  - 支払期限
  - 宛名（クライアント名）
  - 発行者情報（名前、住所、登録番号、振込先）
  - 明細行（品目名、数量、単位、単価）
  - 備考欄

### 3.2. 計算機能
入力された数値に基づき、以下の項目をリアルタイムで自動計算する。
- **小計**: 各明細行の `数量 × 単価` の合計。
- **消費税**: `小計 × 10%`（小数点以下切り捨て）。
- **源泉徴収税**: 
  - ON/OFFの切り替えが可能。
  - ONの場合: `小計 × 10.21%`（小数点以下切り捨て）として計算し、合計から控除する。
  - OFFの場合: 0円として計算。
- **合計金額**: `小計 + 消費税 - 源泉徴収税`。

### 3.3. 明細行管理
- **行追加**: 任意の数の明細行を追加可能。
- **行削除**: 削除ボタンにより明細行を削除可能（明細が1行のみの場合は削除不可）。

### 3.4. データ保存・読み込み
- **自動保存**: 入力内容が変更されるたびに、自動的に `localStorage` へ保存される。
- **自動復元**: アプリケーション起動（リロード）時に、前回保存されたデータを自動的に読み込んで表示する。
- **初回起動時**: 初回アクセス時は、現在日付に基づいたデフォルト値がセットされる。

### 3.5. 印刷・PDF出力
- **印刷モード**: 「PDF発行 / 印刷」ボタン押下によりブラウザの印刷ダイアログを呼び出す。
- **印刷スタイル**:
  - 操作ボタン（リセット、印刷、行追加、削除など）を非表示にする。
  - 入力フォームの枠線を非表示にし、文書としての体裁を整える。
  - 用紙サイズ: A4縦に最適化。

### 3.6. リセット機能
- **データ初期化**: 確認ダイアログを経て、すべての入力内容を初期状態に戻す。
- **番号再生成**: リセット実行時の日付に基づき、請求書番号を再生成する（例: 実行日が11月なら `202311-01`）。

## 4. データ仕様

### 4.1. LocalStorage キー
- **Key**: `simple_invoice_v1`
- **Value**: JSON文字列

### 4.2. データ構造 (JSON Schema)
```json
{
  "invoiceNumber": "String (例: 202310-01)",
  "date": "String (ISO Date YYYY-MM-DD)",
  "dueDate": "String (ISO Date YYYY-MM-DD)",
  "senderName": "String",
  "senderAddress": "String",
  "senderRegNum": "String (T+13桁)",
  "senderBank": "String",
  "clientName": "String",
  "taxRate": "Number (固定: 10)",
  "enableWithholding": "Boolean",
  "items": [
    {
      "id": "Number (Timestamp)",
      "name": "String",
      "quantity": "Number",
      "unit": "String",
      "price": "Number"
    }
  ]
}
```

## 5. UI/UX デザイン方針

* **ペーパーライク**: 画面中央にA4用紙サイズのエリアを配置し、仕上がりイメージそのままで入力させる。

* **ミニマリズム**: 必要なボタン（印刷、リセット）のみをヘッダーに配置し、入力エリアのノイズを極限まで減らす。

* **入力補助**:

  * 金額入力フィールドは右寄せ、数量は中央寄せなど、項目に適した配置を行う。

  * `whitespace-nowrap` 等を使用し、印刷時のレイアウト崩れ（意図しない改行）を防止する。